# Enable Rewrite Engine
RewriteEngine On
RewriteBase /

# Redirect www to non-www and enforce HTTPS
RewriteCond %{HTTPS} off [OR]
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]

# Rewrite index.php to /
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/+index\.php [NC]
RewriteRule ^ / [R=301,L]

# Rewrite non-existing files/directories to index.php
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^ index.php [L]

# Security Headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>

# File Access Restrictions
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Protect .htaccess
<Files .htaccess>
    Require all denied
</Files>

# Prevent Directory Listing
Options -Indexes

# Error handling
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html